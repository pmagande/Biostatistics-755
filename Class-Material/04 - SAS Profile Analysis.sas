data wide_lead;
input ID TRT $ PB1 - PB4;
datalines;
  1      P     30.8    26.9    25.8    23.8
                2      A     26.5    14.8    19.5    21.0
                3      A     25.8    23.0    19.1    23.2
                4      P     24.7    24.5    22.0    22.5
                5      A     20.4     2.8     3.2     9.4
                6      A     20.4     5.4     4.5    11.9
                7      P     28.6    20.8    19.2    18.4
                8      P     33.7    31.6    28.5    25.1
                9      P     19.7    14.9    15.3    14.7
               10      P     31.1    31.2    29.2    30.1
               11      P     19.8    17.5    20.5    27.5
               12      A     24.8    23.1    24.6    30.9
               13      P     21.4    26.3    19.5    19.0
               14      A     27.9     6.3    18.5    16.3
               15      P     21.1    20.3    18.4    20.8
               16      P     20.6    23.9    19.0    17.0
               17      P     24.0    16.7    21.7    20.3
               18      P     37.6    33.7    34.4    31.4
               19      A     35.3    25.5    26.3    30.3
               20      A     28.6    15.8    22.9    25.9
               21      P     31.9    27.9    27.3    34.2
               22      A     29.6    15.8    23.7    23.4
               23      A     21.5     6.5     7.1    16.0
               24      P     26.2    26.8    25.3    24.8
               25      A     21.8    12.0    16.8    19.2
               26      A     23.0     4.2     4.0    16.2
               27      A     22.2    11.5     9.5    14.5
               28      P     20.5    21.1    17.4    21.1
               29      A     25.0     3.9    12.8    12.7
               30      P     33.3    26.2    34.0    28.2
               31      A     26.0    21.4    21.0    22.4
               32      A     19.7    13.2    14.6    11.6
               33      P     27.9    21.6    23.6    27.7
               34      P     24.7    21.2    22.9    21.9
               35      P     28.8    26.4    23.8    22.0
               36      A     29.6    17.5    21.0    24.2
               37      P     32.0    30.2    30.2    27.5
               38      P     21.8    19.3    16.4    17.6
               39      A     24.4    16.4    11.6    16.6
               40      A     33.7    14.9    14.5    63.9
               41      P     24.9    20.9    22.2    19.8
               42      P     19.8    18.9    18.9    15.5
               43      A     26.7     6.4     5.1    15.1
               44      A     26.8    20.4    19.3    23.8
               45      A     20.2    10.6     9.0    16.0
               46      P     35.4    30.4    26.5    28.1
               47      P     25.3    23.9    22.2    27.2
               48      A     20.2    17.5    17.4    18.6
               49      A     24.5    10.0    15.6    15.2
               50      P     20.3    21.0    16.7    13.5
               51      P     20.4    17.2    15.9    17.7
               52      P     24.1    20.1    17.9    18.7
               53      A     27.1    14.9    18.1    21.3
               54      A     34.7    39.0    28.8    34.7
               55      P     28.5    32.6    27.5    22.8
               56      P     26.6    22.4    21.8    21.0
               57      A     24.5     5.1     8.2    23.6
               58      P     20.5    17.5    19.6    18.4
               59      P     25.2    25.1    23.4    22.2
               60      P     34.7    39.5    38.6    43.3
               61      P     30.3    29.4    33.1    28.4
               62      P     26.6    25.3    25.1    27.9
               63      P     20.7    19.3    21.9    21.8
               64      A     27.7     4.0     4.2    11.7
               65      A     24.3    24.3    18.4    27.8
               66      A     36.6    23.3    40.4    39.3
               67      P     28.9    28.9    32.8    31.8
               68      A     34.0    10.7    12.6    21.2
               69      A     32.6    19.0    16.3    18.6
               70      A     29.2     9.2     8.3    18.4
               71      A     26.4    15.3    24.6    32.4
               72      A     21.8    10.6    14.4    18.7
               73      P     27.2    28.5    35.0    30.5
               74      P     22.4    22.0    19.1    18.7
               75      P     32.5    25.1    27.8    27.3
               76      P     24.9    23.6    21.2    21.1
               77      P     24.6    25.0    21.7    23.9
               78      P     23.1    20.9    21.7    19.9
               79      A     21.1     5.6     7.3    12.3
               80      P     25.8    21.9    23.6    24.8
               81      P     30.0    27.6    24.0    23.7
               82      A     22.1    21.0     8.6    24.6
               83      P     20.0    22.7    21.2    20.5
               84      P     38.1    40.8    38.0    32.7
               85      A     28.9    12.5    16.7    22.2
               86      P     25.1    28.1    27.5    24.8
               87      A     19.8    11.6    13.0    23.1
               88      P     22.1    21.1    21.5    20.6
               89      A     23.5     7.9    12.4    18.9
               90      A     29.1    16.8    15.1    18.8
               91      A     30.3     3.5     3.0    11.5
               92      P     25.4    24.3    22.7    20.1
               93      A     30.6    28.2    27.0    25.5
               94      A     22.4     7.1    17.2    18.7
               95      A     31.2    10.8    19.8    22.2
               96      A     31.4     3.9     7.0    17.8
               97      A     41.1    15.1    10.9    27.1
               98      A     29.4    22.1    25.3     4.1
               99      A     21.9     7.6    10.8    13.0
              100      A     20.7     8.1    25.7    12.3
;
			  run;

data long_lead;
  set wide_lead;
  array APB(1:4) PB1-PB4;
  array Aweek(1:4) (0 1 4 6);
  do i=1 to 4;
   PB = APB[i];
   week = Aweek[i];
   output;
  end;
  drop PB1-PB4 Aweek1 - Aweek4 i;
run;

ods rtf path='C:\Users\mclaina\OneDrive - University of South Carolina\Teaching\755_Spring_2022\Examples' (url=none) file='\04 - Profile output.rtf';  

proc mixed data=long_lead method=ml;
class ID TRT week (ref='0');
model PB = TRT week/ s ;
repeated week/type=CSH subject=ID r=1,2 rcorr=1,2 GROUP=TRT;
lsmeans TRT/adjust=TUKEY alpha=0.05 cl;
lsmeans week/adjust=TUKEY alpha=0.05 cl;
run;

proc mixed data=long_lead method=ml;
class ID TRT week (ref='0');
model PB = TRT week week*TRT/ s ;
repeated week/type=CSH subject=ID r=1,2 rcorr=1,2 GROUP=TRT;
lsmeans week*TRT/adjust=TUKEY alpha=0.05;
run;



*Exercise Therapy Study

Description:
The data are from a study of exercise therapies, where 37 patients 
were assigned to one of two weightlifting programs. In the first program (treatment 1), 
the number of repetitions was increased as subjects became stronger. In the
second program (treatment 2), the number of repetitions was fixed but the amount 
of weight was increased as subjects became stronger. Measures of strength were taken
at baseline (day 0), and on days 2, 4, 6, 8, 10, and 12.;


*Variable List: ID, PROGRAM (1=Repetitions Increase, 2=Weights Increase), Response at Time 1,
Response at Time 2, Response at Time 3, Response at Time 4, Response at Time 5,
Response at Time 6, Response at Time 7.;



data Exercise_wide;
input ID Prog S1-S7;
datalines;
      1      1      79     .    79    80    80    78    80
      2      1      83    83    85    85    86    87    87
      3      1      81    83    82    82    83    83    82
      4      1      81    81    81    82    82    83    81
      5      1      80    81    82    82    82     .    86
      6      1      76    76    76    76    76    76    75
      7      1      81    84    83    83    85    85    85
      8      1      77    78    79    79    81    82    81
      9      1      84    85    87    89     .     .    86
     10      1      74    75    78    78    79    78    78
     11      1      76    77    77    77    77    76    76
     12      1      84    84    86    85    86    86    86
     13      1      79    80    79    80    80    82    82
     14      1      78    78    77     .    75    75    76
     15      1      78    80    77    77    75     .    75
     16      1      84    85    85    85    85    83     .
     17      2      84    85    84    83    83    83    84
     18      2      74    75    75    78    75    76    76
     19      2      83    84    82    81     .    83     .
     20      2      86    87    87    87    87    87    86
     21      2      82    83    84    85    84    85    86
     22      2      79    80    79    79    80    79    80
     23      2      79    79    79    81    81    83     .
     24      2      87    89    91    90    91     .     .
     25      2      81    81    81    82    82    83    83
     26      2      82    82     .    84    86    85     .
     27      2      79    79    80    81    81    81     .
     28      2      79    80    81    82    83     .     .
     29      2      83    84    84    84    84     .    83
     30      2      81    81    82    84    83    82    85
     31      2      78    78    79    79    78    79    79
     32      2      83    82    82    84    84    83    84
     33      2      80    79    79    81     .     .    80
     34      2      80    82    82    82    81    81    81
     35      2      85    86    87    86    86    86    86
     36      2      77    78    80    81    82    82    82
     37      2      80    81    80    81    81    82    83
	 ;
	 run;


data Exercise;
  set Exercise_wide;
  array AS(1:7) S1-S7;
  array Aday(1:7) (0 2 4 6 8 10 12);
  do i=1 to 7;
   Stren = AS[i];
   day = Aday[i];
   output;
  end;
  drop S1-S7 Aday1 - Aday7 i;
run;




* Here we'll do separate plots (panels) for each TRT group;
Proc SGpanel data = Exercise;
PanelBy Prog / columns=2;
series x=day y=Stren / group =ID LineAttrs= (pattern=1);
run;



*Now we will include the mean line on the graph by TRT;
proc sort data=Exercise;
by Prog day;

*Calculate the mean by week;
proc means mean data=Exercise;
by Prog day;
var Stren;
output out = MN_Prog_dat mean = mn_prog_Stren; 

proc print data = MN_Prog_dat;
run;


*First, let's look at the mean by TRT group;
Proc SGplot data = MN_Prog_dat;
series x=day y=mn_prog_Stren / group =Prog LineAttrs= (pattern=1 thickness=3);
run;


*Now we'll look at the means by TRT group with the rest of the data;
*Stack the mean data onto the long dataset;
data stacked_Prog;
set Exercise MN_Prog_dat;
run;

proc sort data=stacked_Prog;
by Prog day;

*First we'll do separate plots for each TRT group with the mean on each;
Proc SGplot data = stacked_Prog;
by Prog;
series x=day y=Stren / group =ID LineAttrs= (pattern=1 color="black");
series x=day y=mn_prog_Stren / LineAttrs= (pattern=1 color="blue" thickness=4);
run;



proc mixed data=Exercise method=ml;
class ID Prog day (ref='0');
model Stren = Prog day/ s ;
repeated day/type=CS subject=ID r rcorr;
run;

proc mixed data=Exercise method=ml;
class ID Prog day (ref='0');
model Stren = Prog day day*Prog/ s ;
repeated day/type=CS subject=ID r rcorr;
run;

ods rtf close;
